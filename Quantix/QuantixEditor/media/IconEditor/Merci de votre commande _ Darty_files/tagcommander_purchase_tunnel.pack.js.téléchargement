
window.ANALYTICS=window.ANALYTICS||{};window.ANALYTICS.Tagcommander=(function($){var module={};var datalayer;var recoContainer;var retrievePageData;var retrieveRecoProductsData;var noFavorite='aucun';module.init=function init(){if(this.initialized){return this;}
window.tc_vars={};this.datalayer=datalayer=window.tc_vars;this.mainContainer=mainContainer=new TcContainer('main',$('meta[name="tc_conteneur"]').attr('content'));this.recoContainer=recoContainer=new TcContainer('reco',$('meta[name="tc_conteneur_reco"]').attr('content'));this.retrievePageData=retrievePageData=new Parser('data-tagcommander');this.retrieveProductsData=retrieveProductsData=new ProductsDataParser('data-tagcommander-product');this.retrieveRecoProductsData=retrieveRecoProductsData=new ProductsDataParser('data-tagcommander-reco');this.initialized=true;return this;};module.errors=[];module.getCommonDatalayerData=getCommonDatalayerData;module.fillDataLayer=fillDataLayer;module.updateDatalayer=updateDatalayer;module.getPageUrlWithoutHash=getPageUrlWithoutHash;module.indexOfProductIn=indexOfProductIn;module.setButtonsData=setButtonsData;module.setBlocPositionForProductsIn=setBlocPositionForProductsIn;module.commonListeners=function commonListeners(){listenEarlyBirdsReco();listenSimilarProductsReco();listenShoppingTool();listenBasketAddClick();detectSearchFacetteToClick();listenErrorMessages();listenBasketAddArea();};module.event_idAndTrack=event_idAndTrack;function getCommonDatalayerData(){var data=retrievePageData();if(!data.page_referer){data.page_referer=document.referrer;}
data.page_url=getPageUrlWithoutHash();if(data.page_pagename==='export'){data.page_pagename=typeof window.s_darty!=='undefined'?window.s_darty.pageName||'':'';}
var pageNameElements=data.page_pagename.split('/');data.page_cat1=pageNameElements[1]||'';data.page_cat2=pageNameElements[2]||'';data.page_cat3=pageNameElements[3]||'';data.page_cat4=pageNameElements[4]||'';data.user_email=userEmail();data.user_id=userId();data.user_wishlist_status=userWishlisStatus();data.user_comparator_status='0';data.user_basket_status=basketStatus();data.user_new_customer='non logue';data.user_logged=isLoggedUser()?'1':'0';if(data.page_pagename==='www/espace_client/dartymax'&&$('#popin_longlife')){data.LF_produit_deplacement='';data['LF_produit_main-doeuvre']='';data['LF_produit_pieces-detachees']='';updateLonglifeDatalayer();}
if(isLoggedUser()){data.user_profile=userProfile(data);data.user_longlife=userLongLifeStatus();data.user_postalcode=userPostalcode();if(isOppNewCustomer()){data.user_new_customer='nouveau client';}else{data.user_new_customer='compte actif';}}else{data.user_new_customer='non logue';}
if((data.env_template==='funnel_livraison'||data.env_template==='funnel_paiement'||data.env_template==='funnel_confirmation')&&Cookies.get('PCKLOGIN')===undefined){data.user_new_customer='compte inactif';}
var webAnalysisDartyPck=Cookies.get('WEBA_DARTYPCK');if(webAnalysisDartyPck){data['user_email-urlpck']=webAnalysisDartyPck;}
if(data.env_template==='comparator'&&$('.comparator_products td > .product').length>0){data.user_comparator_status='1';}
if(data.env_template==='funnel_identification'||data.env_template==='funnel_livraison'||data.env_template==='funnel_paiement'){var basket=DARTY_CONF.BASKET.getBasket();if(basket.advantageCode){data.basket_code_promo=basket.advantageCode.toLowerCase();}}
data.user_store=userFavoriteStore();var geoloc_value=Cookies.get('GEOLOCATION')&&Cookies.get('GEOLOCATION')!=='refuses'?'1':'0';updateDatalayer('user_geoloc',geoloc_value);var dartyRecoProductsData=retrieveRecoProductsData();if(dartyRecoProductsData.length){$.map(dartyRecoProductsData,function(product){setButtonsData(product);product.product_partner='darty';});setBlocPositionForProductsIn(dartyRecoProductsData);data.reco_product_array=dartyRecoProductsData;}
trackSearchAutoSuggest();if(localStorage.getItem('AUTOCOMPLETE_SEARCH_TERM')){localStorage.removeItem('AUTOCOMPLETE_SEARCH_TERM');setSearchMetasForRedirectionResult();}
$(document).on('submit',['#dartyCom_searchform_xxl','#form-search'],function(){var inputSearchValue=$(this).find('input[name="text"]').val();localStorage.setItem('INPUT_VALUE_SEARCH',inputSearchValue);});if(localStorage.getItem('INPUT_VALUE_SEARCH')&&data.env_template==='category'){setSearchMetasForRedirectionResult();}else{localStorage.removeItem('INPUT_VALUE_SEARCH');}
if(data.env_template==='myaccount_identification'){if($('.form-field-error')&&$('.form-field-error label').text()==='Identifiant'){data.erreur_type_message='nav_identifiant-incorrect';}
if($('.bloc-title .form-error-message').text()!==''){data.erreur_type_message='nav_identifiant-mdp-incorrect';}}
if(data.env_template==='funnel_livraison'){detecteFocusOutForError('input','notok');}
if(data.env_template==='myaccount_form'){detecteFocusOutForError('.form-fields','form-field-error');}
if($('#darty_warehouse_popin')){$(document).on('click','#in_warehouse_filter_popin_validate_trigger',function(){setTimeout(function(){if($('#darty_warehouse_popin').hasClass('popin-error')){var tc=window.ANALYTICS.Tagcommander;tc.updateDatalayer('erreur_type_message','nav_popin-choose-mag');}},100);});}
return data;}
function detectSearchFacetteToClick(){var tc=window.ANALYTICS.Tagcommander;var formatString=function(value){return value.substring(0,20).trim().replace(/ /g,'-').replace(/[éèê]/g,'e').replace(/[àâ]/g,'a').toLowerCase();};$(document).on('click','[data-filter-link]',function(){var valContent='';if($(this).data('filter-link')!=='selected'){var valContentNameFacette=$(this).data('filter-rubric');valContentNameFacette=formatString(valContentNameFacette);var valContentValueFacette=$(this).data('tracking-filter-value')?$(this).data('tracking-filter-value'):$(this).text();valContentValueFacette=valContentValueFacette.replace(/\n/g,'').replace(/\(.*\)/,'');valContentValueFacette=formatString(valContentValueFacette);valContent=valContentNameFacette+'_'+valContentValueFacette;tc.updateDatalayer('search_nom-facette_nom-valeur-choisie',valContent);sessionStorage.setItem('search_nom-facette_nom-valeur-choisie',valContent);sessionStorage.setItem('TC_SHOPPING_TOOL_DATA','arbo_facette');}});if(tc_vars.env_template==='category'||tc_vars.env_template==='internal_search'){if(sessionStorage.getItem('search_nom-facette_nom-valeur-choisie')!=null){var tagCoVal=sessionStorage.getItem('search_nom-facette_nom-valeur-choisie');tc.updateDatalayer('search_nom-facette_nom-valeur-choisie',tagCoVal);sessionStorage.setItem('search_nom-facette_nom-valeur-choisie','');}}else{sessionStorage.setItem('search_nom-facette_nom-valeur-choisie','');}}
function detecteFocusOutForError(selector,classError){$(document).focusout('input',function(){var tc=window.ANALYTICS.Tagcommander;setTimeout(function(){if($(selector).hasClass(classError)){tc.updateDatalayer('erreur_type_message','nav_inscription-erreur-saisi');}else{tc.updateDatalayer('erreur_type_message','');}},100);});}
function fillDataLayer(data){$.extend(datalayer,data);$(document).trigger('datalayer_is_filled.tagcommander',datalayer);}
function updateDatalayer(key,value,dataObject){if(arguments.length===1&&typeof arguments[0]==='object'){dataObject=arguments[0];$.extend(datalayer,dataObject);}else if(arguments.length===2&&typeof key==='string'){datalayer[key]=value;}
$(document).trigger('datalayer_updated.tagcommander',datalayer);}
function getPageUrlWithoutHash(){var url=window.location;return url.protocol+'//'+url.host+url.pathname+url.search;}
function setSearchMetasForRedirectionResult(){var tc=window.ANALYTICS.Tagcommander;var searchValue=localStorage.getItem('INPUT_VALUE_SEARCH');tc.updateDatalayer('search_type_result','autocomplete');tc.updateDatalayer('search_kw',searchValue);localStorage.removeItem('INPUT_VALUE_SEARCH');sessionStorage.setItem('TC_SHOPPING_TOOL_DATA','moteur_redirection');}
function trackSearchAutoSuggest(){if(localStorage.getItem('SEARCH_AUTO_SUGGEST')==='true'){window.ANALYTICS.Tagcommander.updateDatalayer('search_autosuggest','oui');}else{window.ANALYTICS.Tagcommander.updateDatalayer('search_autosuggest','non');}
localStorage.removeItem('SEARCH_AUTO_SUGGEST');}
function listenEarlyBirdsReco(){$(document).on('ajax_reco_loaded.earlybirds',function(event,responseBody,isBanner){try{if(isBanner)return;var recoProducts=datalayer.reco_product_array||[];$.each(retrieveRecoProductsData(responseBody),function(index,product){product.product_partner='earlybirds';setButtonsData(product);recoProducts.push(product);});setBlocPositionForProductsIn(recoProducts);updateDatalayer('reco_product_array',recoProducts);recoContainer.load();}catch(e){module.errors.push(e);}});}
function listenSimilarProductsReco(){$(document).on('ajax_reco_loaded.similar_products',function(event,responseBody){try{var recoProducts=datalayer.reco_product_array||[];$.each(retrieveRecoProductsData(responseBody),function(index,product){product.product_partner='darty';setButtonsData(product);recoProducts.push(product);});setBlocPositionForProductsIn(recoProducts);updateDatalayer('reco_product_array',recoProducts);recoContainer.load();}catch(e){module.errors.push(e);}});}
function setShoppingTool(){var search=$('[data-tagcommander-shoppingtool]').filter('[name="search"]');if(search.length){sessionStorage.setItem('TC_SHOPPING_TOOL_DATA','moteur_resultat');}}
function listenClickOnDataAttribute(){$(document).on('click','[data-tc-shoppingtool] a, [data-tc-shoppingtool] button',function(){var contentTCShoppingTool=$(this).parents('[data-tc-shoppingtool]').attr('data-tc-shoppingtool');sessionStorage.setItem('TC_SHOPPING_TOOL_DATA',contentTCShoppingTool);});}
function listenShoppingTool(){if(sessionStorage.getItem('TC_SHOPPING_TOOL_DATA')==null){sessionStorage.setItem('TC_SHOPPING_TOOL_DATA','aucunshoppingtool');}
if(window.location.search.indexOf('dartycid')>=1){sessionStorage.setItem('TC_SHOPPING_TOOL_DATA','campagneexterne');}
setShoppingTool();listenClickOnDataAttribute();var readShoppingTool=sessionStorage.getItem('TC_SHOPPING_TOOL_DATA');updateDatalayer('product_shoppingtool',readShoppingTool);}
function checkAttributeIsIncluded(elem){if(elem.toLowerCase().indexOf('inclus')!==-1){return'inclus';}
return'non_inclus';}
function updateLonglifeDatalayer(){var tc=window.ANALYTICS.Tagcommander;var trackingPageName=$('.owl-carousel-longlife').attr('data-tracking-page-name');var popin=$('#popin_longlife');$('body').on('click','.owl-carousel-longlife .c-product-media',function(e){e.preventDefault();tc.updateDatalayer('LF_produit_pieces-detachees',checkAttributeIsIncluded($(this).attr('data-spare-parts-wording')));tc.updateDatalayer('LF_produit_main-doeuvre',checkAttributeIsIncluded($(this).attr('data-labor-wording')));tc.updateDatalayer('LF_produit_deplacement',checkAttributeIsIncluded($(this).attr('data-diagnostic-wording')));tc.updateDatalayer('page_pagename',trackingPageName);});popin.on('closeModal',function(){tc.updateDatalayer('LF_produit_pieces-detachees','');tc.updateDatalayer('LF_produit_main-doeuvre','');tc.updateDatalayer('LF_produit_deplacement','');tc.updateDatalayer('page_pagename','www/espace_client/dartymax');});}
function setBasketAddArea(element,data){var isRecoProduct=$(element).parents('[data-basket-add-area]');var basketAddAreaValue='';if(isRecoProduct.length){basketAddAreaValue=$(isRecoProduct).data('basket-add-area');}else{basketAddAreaValue=$(element).data('basket-add-area');}
data.basket_add_area=basketAddAreaValue;if(basketAddAreaValue.length){sessionStorage.setItem('TC_BASKET_ADD_AREA',basketAddAreaValue);}}
function listenClickOnBasketAddArea(){$(document).on('click','[data-basket-add-area]',function(){var data=retrievePageData();setBasketAddArea(this,data);updateDatalayer(data);});}
function listenBasketAddArea(){var readBasketAddArea=sessionStorage.getItem('TC_BASKET_ADD_AREA');listenClickOnBasketAddArea();if(readBasketAddArea.length){updateDatalayer('basket_add_area',readBasketAddArea);}}
function listenBasketAddClick(){$(document).on('click','.btn-buy, .ajout_panier_bouton',function(){var data=retrievePageData();data.product_shoppingtool=sessionStorage.getItem('TC_SHOPPING_TOOL_DATA');updateDatalayer(data);if(typeof _satellite!=='undefined')_satellite.track('RechargeParielle');});}
function listenErrorMessages(){var errorElement=$('[data-tracking-error]');if(errorElement.length){$(errorElement).each(function(){var errorMessage=$(this).find('.error_message').text();window.ANALYTICS.Tagcommander.updateDatalayer('erreur_type_message','nav_'+errorMessage);_satellite.track('erreur');});}}
function userLongLifeStatus(){var activeStatus;var subscriberStatus;var canceledStatus;var data=retrievePageData();if(data.page_pagename==='www/espace_client/dartymax'||data.page_pagename==='mobile/espace_client/dartymax'){activeStatus=$('#longlife-product-page').attr('data-longlife-active-status');subscriberStatus=$('#longlife-product-page').attr('data-longlife-subscriber-status');canceledStatus=$('#longlife-product-page').attr('data-longlife-canceled-status');}else{activeStatus=$('#longlife-home-page').attr('data-longlife-active-status');subscriberStatus=$('#longlife-home-page').attr('data-longlife-subscriber-status');canceledStatus=$('#longlife-home-page').attr('data-longlife-canceled-status');}
if(subscriberStatus==='true'){return userDartymaxSubscriptionStatus(activeStatus,canceledStatus);}
if(subscriberStatus==='false'){return'non_longlife';}
return undefined;}
function userDartymaxSubscriptionStatus(activeStatus,canceledStatus){if(activeStatus==='true'){return'actif';}
if(canceledStatus==='true'){return'resilie';}
return'suspendu';}
function isLoggedUser(){return cookieExistAndNotEqualToZero('PCKLOGIN');}
function isOppNewCustomer(){return cookieExistAndNotEqualToZero('OPPNEWCUSTOMER');}
function userProfile(data){if(data.premium_status_for_tracking){return data.premium_status_for_tracking;}
var userProfile='';switch(Cookies('PREMIUM_CARD_TYPE')){case'DARTY_PLUS':userProfile='d+';break;case'FNAC_PLUS':userProfile='f+';break;default:userProfile='non_adherent';break;}
return userProfile;}
function userFavoriteStore(){if(isLoggedUser()){var favoriteStore=Cookies('FAVORITE_STORE');return favoriteStore===noFavorite||favoriteStore===''?'':favoriteStore;}
Cookies.set('FAVORITE_STORE');return'';}
function userEmail(){return typeof Cookies('PCKEMAIL')!=='undefined'?Cookies('PCKEMAIL'):'';}
function userId(){return typeof Cookies('s_vi')!=='undefined'?Cookies('s_vi'):'';}
function userWishlisStatus(){return cookieExistAndNotEqualToZero('PCKWISHLIST')?'1':'0';}
function userPostalcode(){return cookieExistAndNotEqualToZero('USERZIPCODE')?Cookies('USERZIPCODE'):'';}
function basketStatus(){var basketCookie='DARTY_BASKET_CONTENT';if(typeof Cookies(basketCookie)==='undefined'){return'0';}
if(Cookies.getJSON(basketCookie).items.length===0){return'0';}
return'1';}
function cookieExistAndNotEqualToZero(cookieName){if(typeof Cookies(cookieName)==='undefined'){return false;}
var content=Cookies(cookieName);if(!content){return false;}
return parseInt(content,10)!==0;}
function TcContainer(containerId,containerUrl){this.id=containerId;this.url=containerUrl;}
TcContainer.prototype.load=function load(){GLOBAL_FUN.dynamicallyLoadScript(this.url);};function indexOfProductIn(targetArray,productId){for(var i=0;i<targetArray.length;i++){if(targetArray[i].product_id.toLowerCase()===productId.toLowerCase()){return i;}}
return-1;}
function setButtonsData(productData){if(typeof productData.product_id!=='string'||!productData.product_availability_code){return productData;}
var AaP=productData.product_availability_code==='athome';var ReM=productData.product_availability_code==='instore';var AaP_ReM=productData.product_availability_code==='all';productData.product_btn_AaP=+(AaP||AaP_ReM);productData.product_btn_ReM=+(ReM||AaP_ReM);productData.product_btn_AaP_ReM=+AaP_ReM;return productData;}
function setBlocPositionForProductsIn(recoProductsArray){if(recoProductsArray.length===0){return;}
var rulesToPositionMap=getRulesPositionMap(recoProductsArray);$.each(recoProductsArray,function(index,product){product.product_position_bloc=rulesToPositionMap[product.product_bloc_rules];});return recoProductsArray;function getRulesPositionMap(recoProductsArray){var allRecoBlocks=[];var lastProcessedBlocRules='';for(var i=0;i<recoProductsArray.length;i++){var product=recoProductsArray[i];if(lastProcessedBlocRules!==product.product_bloc_rules){var elm=$('[data-tagcommander-reco="'+product.product_id+'"][name="product_id"]').parent();var offsetTop=elm.length?Math.round(elm.offset().top):-1;allRecoBlocks.push({offsetTop:offsetTop,rules:product.product_bloc_rules});lastProcessedBlocRules=product.product_bloc_rules;}}
allRecoBlocks.sort(function(a,b){return a.offsetTop-b.offsetTop;});var rulesToPositionMap={};for(var i=0;i<allRecoBlocks.length;i++){var recoBlock=allRecoBlocks[i];recoBlock.position=i+1;rulesToPositionMap[recoBlock.rules]='b'+recoBlock.position;}
return rulesToPositionMap;}}
function Parser(dataSelector){return function(){this.dataSelector='['+dataSelector+']';var $elements=$(this.dataSelector);if($elements.length===0){return false;}
var data={};$elements.each(function(index,element){data[element.name]=element.content;});return data;};}
function ProductsDataParser(dataSelector){return function(restricShearchIn){this.dataSelector='['+dataSelector+']';var $elements;if(typeof restricShearchIn!=='undefined'){$elements=$(restricShearchIn).find(this.dataSelector);}else{$elements=$(this.dataSelector);}
if($elements.length===0){return false;}
var data=[];var codic;var dataIndex=0;var codicToDataIndex={};$elements.each(function(index,element){codic=element.getAttribute([dataSelector]);if(typeof data[codicToDataIndex[codic]]==='undefined'){codicToDataIndex[codic]=dataIndex;dataIndex++;data[codicToDataIndex[codic]]={};}
data[codicToDataIndex[codic]][element.name]=element.content;});return data;};}
function event_idAndTrack(zipCode,inseeCode){var eventName=zipCode+'_'+inseeCode+'_msghorszonedeconfiance';window.ANALYTICS.Tagcommander.updateDatalayer('event_id',eventName);_satellite.track('clic');}
return module;})(jQuery);

$(function(){function loadTagcommander(){var tc=window.ANALYTICS.Tagcommander.init();var data=tc.getCommonDatalayerData();var envTemplate=data.env_template||$('[data-tagcommander][name="env_template"]')[0].content||'';var isBasketPage=envTemplate==='funnel_basket';var isIdentificationPage=envTemplate==='funnel_identification';var isDeliveryPage=envTemplate==='funnel_livraison';var productsBasketData=tc.retrieveProductsData();if(productsBasketData.length){$.map(productsBasketData,tc.setButtonsData);data.basket_products=productsBasketData;}
if(DARTY_CONF.BASKET.getBasket().advantageCode){data.basket_code_promo=DARTY_CONF.BASKET.getBasket().advantageCode;}
if(isDeliveryPage){shippingDeliveryIntituleNb('#breadcrumb_box ul li');}
if(isDeliveryPage&&data.env_plateforme==='mobile'){shippingDeliveryIntituleNb('#breadcrumb_box > div');}
function shippingDeliveryIntituleNb(env_plateforme){var nbShippingDelivery=$(env_plateforme).length;data.basket_nb_shipping=nbShippingDelivery;var intitule='';$(env_plateforme).each(function(index){intitule+=$(this).attr('data-intitule-shipping')+'|';});data.basket_intitule_shipping=intitule.substring(0,intitule.length-1);}
if(isBasketPage){$(document).on('datalayer_is_filled.tagcommander datalayer_updated.tagcommander',function(){setBasketDataInWebStorage(tc.datalayer);});if($('.basket_error_message').length>0){tc.updateDatalayer('erreur_type_message','nav_basket-produit-indispo');}
tc.fillDataLayer(data);var isBasketPageWithZIPCODE=$('#bloc_verif_cp_container').length;if(!isBasketPageWithZIPCODE){tc.mainContainer.load();}
listenBasketRefresh();listenEarlyBirdsRecoBasket();}else{if(isIdentificationPage||isDeliveryPage){$.extend(data,getBasketDataInWebStorage());}
tc.fillDataLayer(data);tc.mainContainer.load();tc.commonListeners();listenFragmentsLoads();}}
try{loadTagcommander();}catch(e){window.ANALYTICS.Tagcommander.errors.push(e);}
function setBasketDataInWebStorage(datalayer){var basketData={basket_products:datalayer.basket_products||'',basket_amount_ati:datalayer.basket_amount_ati||''};DARTY_CONF.STORAGE.saveSession('TC_BASKET_DATA',basketData);}
function getBasketDataInWebStorage(){var basketDataJson=DARTY_CONF.STORAGE.readSession('TC_BASKET_DATA')||{};if(typeof basketDataJson==='string'){return window.JSON.parse(basketDataJson);}
return basketDataJson;}
function listenBasketRefresh(){var tc=window.ANALYTICS.Tagcommander;$(document).add('body').on('refresh',function(){try{if($('.basket_error_message').length>0){tc.updateDatalayer('erreur_type_message','nav_basket-produit-indispo');}else{tc.updateDatalayer('erreur_type_message','');}
var data=tc.retrievePageData();data.basket_products=tc.retrieveProductsData();tc.updateDatalayer(data);tc_events_2(this,'EulerianChangeBasket',{});}catch(e){tc.errors.push(e);}});}
function listenEarlyBirdsRecoBasket(){$(document).on('ajax_reco_loaded.earlybirds',function(event,responseBody,isBanner){var tc=window.ANALYTICS.Tagcommander;try{if(isBanner)return;var recoProducts=tc.datalayer.reco_product_array||[];$.each(tc.retrieveRecoProductsData(responseBody),function(index,product){product.product_partner='earlybirds';tc.setButtonsData(product);var indexOfProduct=tc.indexOfProductIn(recoProducts,product.product_id);if(indexOfProduct>-1){recoProducts[indexOfProduct]=product;}else{recoProducts.push(product);}});tc.setBlocPositionForProductsIn(recoProducts);tc.updateDatalayer('reco_product_array',recoProducts);tc.commonListeners();tc.recoContainer.load();}catch(e){tc.errors.push(e);}});}
function listenFragmentsLoads(){$(document).on('fragment_loaded',function(e,fragmentName){var tc=window.ANALYTICS.Tagcommander;try{var data={};var pageNameElements=tc.datalayer.page_pagename.split('/');var trackingTable={darty:'livraison_darty-creneaux',monoequipage:'livraison_darty-infos',transporteur:'livraison_transporteurs2',marketplace:'livraison_vendeurs2',clickandcollect:'livraison_retrait2',one_click:'paiement_oneclick',magasin:'paiement_magasin',carte_bleue:'paiement_carte',paylib:'paiement_paylib',paypal:'paiement_paypal',plusieurs_fois:'paiement_plusieursfois',autre:'paiement_americanetautre'};if(fragmentName.indexOf('error')>-1){data.env_template='other_errors';}
pageNameElements.pop();pageNameElements.push(getPageNameEndFrom(fragmentName));data.page_pagename=pageNameElements.join('/');data.page_referer=document.referrer;data.page_url=tc.getPageUrlWithoutHash();data.page_cat1=pageNameElements[1]||'';data.page_cat2=pageNameElements[2]||'';data.page_cat3=pageNameElements[3]||'';tc.updateDatalayer(data);tc.mainContainer.load();var template=tc.datalayer.env_template;if(trackingTable.hasOwnProperty(fragmentName)){window.ANALYTICS.Tagcommander.updateDatalayer('event_id',trackingTable[fragmentName]);if(template==='funnel_livraison'){_satellite.track('delivery_substep');}else if(template==='funnel_paiement'){_satellite.track('under_paiement_step');}}}catch(e){tc.errors.push(e);}});function getPageNameEndFrom(fragmentName){var fragmentNameToPageNameEnd={destinataire:$('#streetShipping').val()===''?'creation_adresse':'modification_adresse',choix_destinataire:'choix_destinataire',transporteur:'livre_transporteur',darty:'livre_darty',monoequipage:'formulaire_equipement',marketplace:'vendeurs_partenaires',clickandcollect:'retrait_magasin',one_click:'mes_moyens',magasin:'en_magasin',carte_bleue:'par_carte',paypal:'paypal',paylib:'paylib',plusieurs_fois_x3cb:'en_plusieurs_fois_x3cb',plusieurs_fois_x4cb:'en_plusieurs_fois_x4cb',plusieurs_fois:'en_plusieurs_fois',autre:'autres'};return fragmentNameToPageNameEnd[fragmentName]||'non_renseigne-'+fragmentName;}}});
